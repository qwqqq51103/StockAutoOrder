# å¦‚ä½•ä¿®æ”¹Kç·šè Ÿç‡­åœ–æ™‚é–“é€±æœŸ

## ğŸ“ ä¿®æ”¹ä½ç½®

**æª”æ¡ˆï¼š** `D:\è‡ªå‹•æ›å–®ç‰ˆsrc\StockMainAction\view\MainView.java`

---

## ğŸ”§ ä¿®æ”¹æ–¹æ³•

### 1ï¸âƒ£ ä¿®æ”¹å¯ç”¨çš„æ™‚é–“é€±æœŸé¸é …ï¼ˆç¬¬ 210-211 è¡Œï¼‰

```java
// Kç·šå¤šé€±æœŸç®¡ç†ï¼ˆæ–°å¢ 10ç§’ã€30ç§’ ä»¥ç§’ç‚ºå–®ä½ä»¥ 0.x è¡¨ç¤ºï¼Œå…§éƒ¨æœƒæ›ç®—ï¼‰
private final int[] klineMinutes = new int[]{1, 5, 10, 30, 60};
private final int[] klineSeconds = new int[]{10, 30, 60};
```

#### èªªæ˜ï¼š
- **`klineSeconds`**ï¼šç§’ç´šKç·šé€±æœŸï¼ˆå¦‚ 10ç§’ã€30ç§’ã€60ç§’ï¼‰
- **`klineMinutes`**ï¼šåˆ†é˜ç´šKç·šé€±æœŸï¼ˆå¦‚ 1åˆ†ã€5åˆ†ã€10åˆ†ã€30åˆ†ã€60åˆ†ï¼‰

#### ç¯„ä¾‹ä¿®æ”¹ï¼š

**æ–°å¢ 5ç§’ã€15ç§’ã€120ç§’é€±æœŸï¼š**
```java
private final int[] klineSeconds = new int[]{5, 10, 15, 30, 60, 120};
```

**æ–°å¢ 15åˆ†ã€45åˆ†é€±æœŸï¼š**
```java
private final int[] klineMinutes = new int[]{1, 5, 10, 15, 30, 45, 60};
```

**ç§»é™¤æŸäº›é€±æœŸï¼ˆä¾‹å¦‚åªä¿ç•™ 10ç§’ã€1åˆ†ã€5åˆ†ï¼‰ï¼š**
```java
private final int[] klineSeconds = new int[]{10};
private final int[] klineMinutes = new int[]{1, 5};
```

---

### 2ï¸âƒ£ ä¿®æ”¹é è¨­é¡¯ç¤ºçš„Kç·šé€±æœŸï¼ˆç¬¬ 1789-1790 è¡Œï¼‰

åœ¨ `createCharts()` æ–¹æ³•ä¸­æ‰¾åˆ°ï¼š

```java
// é è¨­ä½¿ç”¨ 10 ç§’ K ç·š
currentKlineMinutes = -10;
```

#### èªªæ˜ï¼š
- **è² æ•¸å€¼**ï¼šè¡¨ç¤ºç§’ç´šé€±æœŸï¼ˆå¦‚ `-10` = 10ç§’ï¼Œ`-30` = 30ç§’ï¼‰
- **æ­£æ•¸å€¼**ï¼šè¡¨ç¤ºåˆ†é˜ç´šé€±æœŸï¼ˆå¦‚ `1` = 1åˆ†é˜ï¼Œ`5` = 5åˆ†é˜ï¼‰

#### ç¯„ä¾‹ä¿®æ”¹ï¼š

**é è¨­ä½¿ç”¨ 1åˆ†é˜ Kç·šï¼š**
```java
currentKlineMinutes = 1;
```

**é è¨­ä½¿ç”¨ 30ç§’ Kç·šï¼š**
```java
currentKlineMinutes = -30;
```

**é è¨­ä½¿ç”¨ 5åˆ†é˜ Kç·šï¼š**
```java
currentKlineMinutes = 5;
```

---

### 3ï¸âƒ£ ä¿®æ”¹æ¯å€‹é€±æœŸä¿ç•™çš„Kç·šæ ¹æ•¸ï¼ˆç¬¬ 1775ã€1783 è¡Œï¼‰

åœ¨ `createCharts()` æ–¹æ³•ä¸­ï¼š

```java
// ç§’ç´šKç·š
for (int s : klineSeconds) {
    OHLCSeries srs = new OHLCSeries("Kç·š(" + s + "ç§’)");
    try { srs.setMaximumItemCount(30); } catch (Exception ignore) {}  // â† é€™è£¡è¨­å®šæœ€å¤§æ ¹æ•¸
    // ...
}

// åˆ†é˜ç´šKç·š
for (int m : klineMinutes) {
    OHLCSeries s = new OHLCSeries("Kç·š(" + m + "åˆ†)");
    try { s.setMaximumItemCount(30); } catch (Exception ignore) {}  // â† é€™è£¡è¨­å®šæœ€å¤§æ ¹æ•¸
    // ...
}
```

#### ç¯„ä¾‹ä¿®æ”¹ï¼š

**ç§’ç´šKç·šé¡¯ç¤ºæœ€å¤š 60 æ ¹ï¼š**
```java
try { srs.setMaximumItemCount(60); } catch (Exception ignore) {}
```

**åˆ†é˜ç´šKç·šé¡¯ç¤ºæœ€å¤š 100 æ ¹ï¼š**
```java
try { s.setMaximumItemCount(100); } catch (Exception ignore) {}
```

---

## ğŸ“Š å®Œæ•´ç¯„ä¾‹ï¼šè‡ªè¨‚Kç·šé€±æœŸé…ç½®

### ç¯„ä¾‹ 1ï¼šçŸ­ç·šäº¤æ˜“è€…é…ç½®ï¼ˆç§’ç´šç‚ºä¸»ï¼‰

```java
// ç¬¬ 210-211 è¡Œ
private final int[] klineSeconds = new int[]{5, 10, 15, 30, 60};  // 5ç§’åˆ°60ç§’
private final int[] klineMinutes = new int[]{1, 3, 5};            // 1åˆ†ã€3åˆ†ã€5åˆ†

// ç¬¬ 1789-1790 è¡Œ
currentKlineMinutes = -5;  // é è¨­é¡¯ç¤º 5ç§’ Kç·š

// ç¬¬ 1775 è¡Œ
try { srs.setMaximumItemCount(120); } catch (Exception ignore) {}  // ç§’ç´šKç·šé¡¯ç¤º120æ ¹

// ç¬¬ 1783 è¡Œ
try { s.setMaximumItemCount(60); } catch (Exception ignore) {}  // åˆ†é˜ç´šKç·šé¡¯ç¤º60æ ¹
```

### ç¯„ä¾‹ 2ï¼šæ³¢æ®µäº¤æ˜“è€…é…ç½®ï¼ˆåˆ†é˜ç´šç‚ºä¸»ï¼‰

```java
// ç¬¬ 210-211 è¡Œ
private final int[] klineSeconds = new int[]{30, 60};               // åªä¿ç•™30ç§’ã€60ç§’
private final int[] klineMinutes = new int[]{1, 5, 15, 30, 60, 120};  // 1åˆ†åˆ°120åˆ†

// ç¬¬ 1789-1790 è¡Œ
currentKlineMinutes = 5;  // é è¨­é¡¯ç¤º 5åˆ†é˜ Kç·š

// ç¬¬ 1775 è¡Œ
try { srs.setMaximumItemCount(30); } catch (Exception ignore) {}  // ç§’ç´šKç·šé¡¯ç¤º30æ ¹

// ç¬¬ 1783 è¡Œ
try { s.setMaximumItemCount(200); } catch (Exception ignore) {}  // åˆ†é˜ç´šKç·šé¡¯ç¤º200æ ¹
```

### ç¯„ä¾‹ 3ï¼šç•¶æ²–äº¤æ˜“è€…é…ç½®ï¼ˆæ¥µçŸ­ç·šï¼‰

```java
// ç¬¬ 210-211 è¡Œ
private final int[] klineSeconds = new int[]{3, 5, 10, 20, 30};  // 3ç§’ã€5ç§’ã€10ç§’ã€20ç§’ã€30ç§’
private final int[] klineMinutes = new int[]{1, 2, 3, 5};        // 1åˆ†ã€2åˆ†ã€3åˆ†ã€5åˆ†

// ç¬¬ 1789-1790 è¡Œ
currentKlineMinutes = -3;  // é è¨­é¡¯ç¤º 3ç§’ Kç·š

// ç¬¬ 1775 è¡Œ
try { srs.setMaximumItemCount(200); } catch (Exception ignore) {}  // ç§’ç´šKç·šé¡¯ç¤º200æ ¹

// ç¬¬ 1783 è¡Œ
try { s.setMaximumItemCount(100); } catch (Exception ignore) {}  // åˆ†é˜ç´šKç·šé¡¯ç¤º100æ ¹
```

---

## ğŸ” ç¨‹å¼ç¢¼è§£æ

### é€±æœŸå„²å­˜æ©Ÿåˆ¶

ç³»çµ±ä½¿ç”¨ `Map` ä¾†å„²å­˜ä¸åŒé€±æœŸçš„Kç·šæ•¸æ“šï¼š

```java
private final Map<Integer, OHLCSeries> minuteToSeries = new HashMap<>();
```

- **Key ç‚ºæ­£æ•¸**ï¼šè¡¨ç¤ºåˆ†é˜é€±æœŸï¼ˆä¾‹å¦‚ `1` = 1åˆ†é˜ï¼‰
- **Key ç‚ºè² æ•¸**ï¼šè¡¨ç¤ºç§’é€±æœŸï¼ˆä¾‹å¦‚ `-10` = 10ç§’ï¼‰

### æ™‚é–“æ¡¶å°é½Š

åœ¨ `updatePriceChart()` æ–¹æ³•ä¸­ï¼ˆç¬¬ 2412-2426 è¡Œï¼‰ï¼Œç³»çµ±æœƒæ ¹æ“šç•¶å‰é€±æœŸè¨ˆç®—æ™‚é–“æ¡¶ï¼š

```java
if (currentKlineMinutes < 0) {
    int s = -currentKlineMinutes; // ç§’
    long bucketMs = 1000L * s;
    aligned = now - (now % bucketMs);
    period = new Second(new java.util.Date(aligned));
} else {
    int m = currentKlineMinutes;  // åˆ†
    long bucketMs = 60_000L * m;
    aligned = now - (now % bucketMs);
    period = new Minute(new java.util.Date(aligned));
}
```

**ä¾‹å¦‚ï¼š**
- 10ç§’Kç·šï¼šæ¯10ç§’å°é½Šä¸€æ¬¡ï¼ˆ10:30:00ã€10:30:10ã€10:30:20...ï¼‰
- 1åˆ†é˜Kç·šï¼šæ¯1åˆ†é˜å°é½Šä¸€æ¬¡ï¼ˆ10:30:00ã€10:31:00ã€10:32:00...ï¼‰
- 5åˆ†é˜Kç·šï¼šæ¯5åˆ†é˜å°é½Šä¸€æ¬¡ï¼ˆ10:30:00ã€10:35:00ã€10:40:00...ï¼‰

---

## âš ï¸ æ³¨æ„äº‹é …

### 1. é€±æœŸå€¼é™åˆ¶

- **ç§’ç´šé€±æœŸ**ï¼šå»ºè­°ç¯„åœ 1 ~ 120 ç§’ï¼ˆä¸å»ºè­°è¶…é2åˆ†é˜ï¼Œå¦å‰‡æ‡‰æ”¹ç”¨åˆ†é˜ç´šï¼‰
- **åˆ†é˜ç´šé€±æœŸ**ï¼šå»ºè­°ç¯„åœ 1 ~ 240 åˆ†é˜ï¼ˆ1åˆ†é˜åˆ°4å°æ™‚ï¼‰

### 2. è¨˜æ†¶é«”ä½¿ç”¨

Kç·šæ ¹æ•¸è¶Šå¤šï¼Œè¨˜æ†¶é«”ä½¿ç”¨è¶Šå¤§ï¼š

| é€±æœŸé¡å‹ | å»ºè­°æœ€å¤§æ ¹æ•¸ | è¨˜æ†¶é«”ä½”ç”¨ |
|---------|-------------|-----------|
| **ç§’ç´š** | 30-120 æ ¹ | è¼ƒä½ |
| **åˆ†é˜ç´š** | 60-200 æ ¹ | ä¸­ç­‰ |
| **å°æ™‚ç´š** | 100-500 æ ¹ | è¼ƒé«˜ |

### 3. æ•ˆèƒ½å½±éŸ¿

- **éå¤šé€±æœŸé¸é …**ï¼šæœƒå¢åŠ åˆå§‹åŒ–æ™‚é–“å’Œè¨˜æ†¶é«”ä½¿ç”¨
- **éå¤šKç·šæ ¹æ•¸**ï¼šæœƒå½±éŸ¿åœ–è¡¨æ¸²æŸ“æ•ˆèƒ½
- **å»ºè­°é…ç½®**ï¼š3-6å€‹å¸¸ç”¨é€±æœŸï¼Œæ¯å€‹é€±æœŸä¿ç•™30-100æ ¹Kç·š

### 4. æ•¸æ“šåŒæ­¥

ç³»çµ±åœ¨ `updatePriceChart()` ä¸­æœƒåŒæ™‚æ›´æ–°å¤šå€‹é€±æœŸçš„Kç·šï¼š

```java
// [CHART] å¦å¤–æ›´æ–°å¤šé€±æœŸè³‡æ–™ï¼ˆ30ç§’ã€60ç§’ã€10åˆ†ã€30åˆ†ï¼‰
int[] extraKeys = new int[]{-30, -60, 10, 30};
for (int key : extraKeys) {
    if (key == currentKlineMinutes) continue;
    try { updateOhlcForKey(price, now, key); } catch (Exception ignore) {}
}
```

å¦‚æœæ‚¨æ–°å¢äº†æ–°çš„é€±æœŸï¼Œå¯ä»¥è€ƒæ…®å°‡å…¶åŠ å…¥ `extraKeys` é™£åˆ—ä»¥ä¿æŒæ•¸æ“šåŒæ­¥ã€‚

---

## ğŸ¯ å¿«é€Ÿä¿®æ”¹æ­¥é©Ÿ

### å¦‚æœæ‚¨åªæƒ³æ”¹è®Šé è¨­é€±æœŸï¼š

1. æ‰¾åˆ°ç¬¬ **1789-1790** è¡Œ
2. ä¿®æ”¹ `currentKlineMinutes` çš„å€¼ï¼š
   - æ”¹ç‚º `1` â†’ é è¨­1åˆ†é˜
   - æ”¹ç‚º `5` â†’ é è¨­5åˆ†é˜
   - æ”¹ç‚º `-30` â†’ é è¨­30ç§’
3. å„²å­˜ä¸¦é‡æ–°ç·¨è­¯

### å¦‚æœæ‚¨æƒ³æ–°å¢æ–°çš„é€±æœŸé¸é …ï¼š

1. æ‰¾åˆ°ç¬¬ **210-211** è¡Œ
2. åœ¨ `klineSeconds` æˆ– `klineMinutes` é™£åˆ—ä¸­æ–°å¢æ•¸å€¼
3. ä¾‹å¦‚æ–°å¢ 2åˆ†é˜é€±æœŸï¼š
   ```java
   private final int[] klineMinutes = new int[]{1, 2, 5, 10, 30, 60};
   ```
4. å„²å­˜ä¸¦é‡æ–°ç·¨è­¯

---

## ğŸ“š ç›¸é—œæª”æ¡ˆ

- **ä¸»è¦æª”æ¡ˆ**ï¼š`MainView.java`ï¼ˆè¡Œæ•¸ï¼š210-211ã€1773-1790ã€2412-2463ï¼‰
- **é€±æœŸåˆ‡æ›é‚è¼¯**ï¼š`updatePriceChart()` æ–¹æ³•
- **é€±æœŸæ•¸æ“šæ›´æ–°**ï¼š`updateOhlcForKey()` æ–¹æ³•

---

## â“ å¸¸è¦‹å•é¡Œ

### Q1: å¯ä»¥æ–°å¢å°æ™‚ç´šKç·šå—ï¼Ÿ

**A:** å¯ä»¥ï¼åªéœ€åœ¨ `klineMinutes` ä¸­æ–°å¢ 60 çš„å€æ•¸å³å¯ï¼š

```java
private final int[] klineMinutes = new int[]{1, 5, 15, 30, 60, 120, 240};
// 60 = 1å°æ™‚, 120 = 2å°æ™‚, 240 = 4å°æ™‚
```

### Q2: ç‚ºä»€éº¼ç§’ç´šé€±æœŸç”¨è² æ•¸è¡¨ç¤ºï¼Ÿ

**A:** é€™æ˜¯ç¨‹å¼è¨­è¨ˆä¸Šçš„æŠ€å·§ï¼Œç”¨æ­£è² å€¼å€åˆ†ã€Œåˆ†é˜ã€å’Œã€Œç§’ã€å…©ç¨®å–®ä½ï¼Œæ–¹ä¾¿åœ¨åŒä¸€å€‹ Map ä¸­å„²å­˜ï¼Œé¿å…ä½¿ç”¨å…©å€‹ç¨ç«‹çš„ Mapã€‚

### Q3: ä¿®æ”¹å¾Œéœ€è¦æ¸…é™¤èˆŠæ•¸æ“šå—ï¼Ÿ

**A:** ä¸éœ€è¦ã€‚é‡æ–°å•Ÿå‹•ç¨‹å¼å¾Œï¼Œæ‰€æœ‰Kç·šæ•¸æ“šæœƒé‡æ–°åˆå§‹åŒ–ã€‚

### Q4: å¯ä»¥å‹•æ…‹åˆ‡æ›é€±æœŸå—ï¼Ÿ

**A:** ç›®å‰ç³»çµ±æ”¯æ´å¤šé€±æœŸä¸¦å­˜ï¼Œä½†åˆ‡æ›é€±æœŸçš„UIæ§ä»¶å¯èƒ½éœ€è¦å¦å¤–å¯¦ä½œã€‚ç¾æœ‰çš„ `currentKlineMinutes` è®Šæ•¸æ§åˆ¶ç•¶å‰é¡¯ç¤ºçš„é€±æœŸã€‚

---

## ğŸ‰ ç¸½çµ

ä¿®æ”¹Kç·šé€±æœŸåªéœ€è¦ç°¡å–®çš„ä¸‰å€‹æ­¥é©Ÿï¼š

1. âœ… ä¿®æ”¹å¯ç”¨é€±æœŸé™£åˆ—ï¼ˆç¬¬ 210-211 è¡Œï¼‰
2. âœ… ä¿®æ”¹é è¨­é€±æœŸï¼ˆç¬¬ 1789-1790 è¡Œï¼‰  
3. âœ… èª¿æ•´Kç·šæ ¹æ•¸ï¼ˆç¬¬ 1775ã€1783 è¡Œï¼Œå¯é¸ï¼‰

ä¿®æ”¹å®Œæˆå¾Œï¼Œé‡æ–°ç·¨è­¯åŸ·è¡Œå³å¯ï¼

---

**æ–‡ä»¶ç‰ˆæœ¬ï¼š** 1.0  
**æœ€å¾Œæ›´æ–°ï¼š** 2025-10-23  
**ä½œè€…ï¼š** AI Assistant

